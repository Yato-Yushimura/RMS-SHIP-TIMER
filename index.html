<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ship Timer</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: "Segoe UI", Arial, sans-serif; color: #fff; display: flex; justify-content: center; align-items: flex-start; box-sizing: border-box; min-height: 100vh; overflow-x: hidden; }
    #bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -2; }
    #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.55); backdrop-filter: blur(4px); z-index: -1; }
    #timers { width: 100%; max-width: 1200px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 20px; z-index: 1; position: relative; }
    .timer-container { background: rgba(30, 30, 30, 0.6); border-radius: 16px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.4); display: flex; flex-direction: column; align-items: center; min-height: 300px; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .timer-container:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.5); }
    .serverDisplay { font-size: 22px; color: #ffea00; margin-bottom: 12px; font-weight: bold; text-align: center; }
    .button-row { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; justify-content: center; }
    .button-row button { padding: 8px 14px; font-size: 14px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; cursor: pointer; transition: background 0.3s ease, transform 0.15s ease; }
    .button-row button:hover { background: rgba(255,255,255,0.25); transform: scale(1.05); }
    .timer { font-size: 52px; font-weight: bold; margin: 15px 0 10px 0; text-align: center; color: #ffffff; text-shadow: 0 0 12px rgba(0,0,0,0.6); }
    .status { font-size: 16px; text-align: center; line-height: 1.4; padding: 0 8px; }
    .event { color: #00e676; } .waiting { color: #ffcc00; } .alert { color: #ff5252; font-weight: bold; }
    .add-timer-btn { margin-top: 12px; width: 100%; padding: 12px 0; font-size: 15px; border-radius: 10px; background: rgba(0,150,255,0.8); border: none; color: #fff; cursor: pointer; transition: background 0.3s ease; }
    .add-timer-btn:hover { background: rgba(0,120,220,0.9); }
    #video-error { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 3; background: rgba(0,0,0,0.5); }
    #video-error .box { background: rgba(20,20,20,0.95); color: #fff; padding: 18px; border-radius: 10px; width: min(520px, 92%); text-align: center; box-shadow: 0 8px 30px rgba(0,0,0,0.6); }
    #video-error .msg { margin-bottom: 12px; font-size: 14px; line-height: 1.3; word-break: break-word; }
    #video-error button { padding: 10px 14px; font-size: 14px; border-radius: 8px; border: none; cursor: pointer; background: rgba(0,150,255,0.95); color: #fff; }
  </style>
</head>
<body>
  <video id="bg-video" autoplay muted loop playsinline></video>
  <div id="video-error"><div class="box"><div class="msg"></div><button id="video-retry">Try to play video</button></div></div>
  <div id="overlay"></div>
  <div id="timers"></div>
<script>
  const eventDuration = 5 * 60;
  const waitDuration = 10 * 60;
  const totalCycle = eventDuration + waitDuration;
  const shipArrivesVideo = "C:\\Users\\Kristof\\Videos\\Roblox\\shiparrives.mp4";
  const shipLeavesVideo = "C:\\Users\\Kristof\\Videos\\Roblox\\shipleaves.mp4";
  const bgVideo = document.getElementById("bg-video");
  const videoErrorEl = document.getElementById("video-error");
  const videoRetryBtn = document.getElementById("video-retry");
  let timers = [];
  function toURL(p) {
    if (!p) return "";
    if (p.match(/^[a-zA-Z]:\\/)) return "file:///" + p.replace(/\\/g, "/");
    return p;
  }
  function showVideoError(msg) {
    videoErrorEl.style.display = "flex";
    const el = videoErrorEl.querySelector(".msg");
    el.textContent = msg;
  }
  function hideVideoError() {
    videoErrorEl.style.display = "none";
  }
  function switchVideo(src) {
    const url = toURL(src);
    if (!url) return;
    if (bgVideo.dataset.current === url) return;
    bgVideo.dataset.current = url;
    hideVideoError();
    try {
      bgVideo.pause();
      bgVideo.muted = true;
      bgVideo.src = url;
      bgVideo.load();
      const p = bgVideo.play();
      if (p && typeof p.then === "function") {
        p.then(() => hideVideoError()).catch(err => showVideoError(err && err.message ? err.message : "Playback blocked. Click Try to play."));
      }
    } catch (err) {
      showVideoError(err && err.message ? err.message : "Video load error");
    }
  }
  bgVideo.addEventListener("error", function() {
    const code = bgVideo.error && bgVideo.error.code ? bgVideo.error.code : "unknown";
    showVideoError("Video error (code " + code + "). Check file path or console.");
  });
  bgVideo.addEventListener("loadeddata", function() {
    hideVideoError();
  });
  videoRetryBtn.addEventListener("click", function() {
    hideVideoError();
    bgVideo.play().catch(err => showVideoError(err && err.message ? err.message : "Play failed"));
  });
  function speak(text) {
    const synth = window.speechSynthesis;
    let voices = synth.getVoices();
    if (!voices.length) {
      window.speechSynthesis.onvoiceschanged = () => speak(text);
      return;
    }
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "en-US";
    const preferredVoiceNames = ["Google US English","Google UK English Female","Microsoft Zira Desktop","Samantha"];
    const selectedVoice = voices.find(v => preferredVoiceNames.some(name => v.name.includes(name)));
    utterance.voice = selectedVoice || voices[0];
    synth.speak(utterance);
  }
  function speakServerNumber(timer) {
    const numberWords = {1:'one',2:'two',3:'three',4:'four',5:'five',6:'six',7:'seven',8:'eight',9:'nine',10:'ten'};
    if (!timer.serverId) return;
    const word = numberWords[timer.serverId] || timer.serverId.toString();
    speak("Server " + word);
  }
  function addTimer(id) {
    const container = document.createElement("div");
    container.className = "timer-container";
    container.id = "timer-container-" + id;
    container.innerHTML = `
      <div id="serverDisplay-${id}" class="serverDisplay">üß≠ Server: Not assigned</div>
      <div class="button-row">
        <button onclick="setServer(${id})">üéØ Assign Server</button>
        <button onclick="startCycle(${id}, 0)">üö¢ Ship Arrived</button>
        <button onclick="startCycle(${id}, ${5*60})">üïì Ship Left</button>
        <button onclick="adjustTime(${id}, 10)">‚ûï 10s</button>
        <button onclick="adjustTime(${id}, -10)">‚ûñ 10s</button>
        <button onclick="togglePause(${id})" id="pauseBtn-${id}">‚è∏ Pause</button>
      </div>
      <div id="timer-${id}" class="timer">00:00</div>
      <div id="status-${id}" class="status">Press a button based on what you see in the game.</div>
      ${id === 1 ? `<button class="add-timer-btn" onclick="addNewTimer()">‚ûï Add Timer</button>` : ''}
    `;
    document.getElementById("timers").appendChild(container);
    timers.push({
      id: id,
      serverId: null,
      startTime: null,
      pausedAt: null,
      paused: false,
      interval: setInterval(() => updateTimer(id), 1000),
      beepPlayedAtStart: false,
      beepPlayedOneMinuteBefore: false,
      spokenOneMinuteBefore: false,
      spokenEventEnd: false
    });
    updateTimer(id);
  }
  function addNewTimer() {
    if (timers.length >= 9) {
      alert("Max 9 timers allowed.");
      return;
    }
    const newId = timers.length + 1;
    addTimer(newId);
  }
  function setServer(id) {
    const input = prompt("Enter the server number (e.g., 1, 2, 3):");
    if (input && !isNaN(input)) {
      const num = parseInt(input);
      timers[id - 1].serverId = num;
      document.getElementById("serverDisplay-" + id).textContent = "üß≠ Server: " + num;
      speakServerNumber(timers[id - 1]);
    } else {
      alert("Please enter a valid number.");
    }
  }
  function startCycle(id, offsetSeconds) {
    const now = Date.now();
    const timer = timers[id - 1];
    timer.startTime = now - offsetSeconds * 1000;
    timer.paused = false;
    timer.pausedAt = null;
    timer.beepPlayedAtStart = false;
    timer.beepPlayedOneMinuteBefore = false;
    timer.spokenOneMinuteBefore = false;
    timer.spokenEventEnd = false;
    document.getElementById("pauseBtn-" + id).textContent = "‚è∏ Pause";
    updateTimer(id);
  }
  function adjustTime(id, seconds) {
    const timer = timers[id - 1];
    if (!timer.startTime || timer.paused) return;
    timer.startTime -= seconds * 1000;
    updateTimer(id);
  }
  function togglePause(id) {
    const timer = timers[id - 1];
    if (!timer.startTime) {
      alert("‚è∏ You must start the timer before pausing it.");
      return;
    }
    const now = Date.now();
    if (timer.paused) {
      const pausedDuration = now - timer.pausedAt;
      timer.startTime += pausedDuration;
      timer.paused = false;
      timer.pausedAt = null;
      document.getElementById("pauseBtn-" + id).textContent = "‚è∏ Pause";
    } else {
      timer.pausedAt = now;
      timer.paused = true;
      document.getElementById("pauseBtn-" + id).textContent = "‚ñ∂ Resume";
    }
  }
  function playBeep() {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    oscillator.type = "sine";
    oscillator.frequency.setValueAtTime(1000, ctx.currentTime);
    gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    oscillator.start();
    oscillator.stop(ctx.currentTime + 0.3);
  }
  function getServerText(timer) {
    if (timer.serverId !== null) {
      const numberWords = {1:'one',2:'two',3:'three',4:'four',5:'five',6:'six',7:'seven',8:'eight',9:'nine',10:'ten'};
      const word = numberWords[timer.serverId] || timer.serverId.toString();
      return " server " + word;
    }
    return "";
  }
  function updateTimer(id) {
    const now = Date.now();
    const timer = timers[id - 1];
    const display = document.getElementById("timer-" + id);
    const status = document.getElementById("status-" + id);
    if (!timer.startTime) {
      display.textContent = "00:00";
      status.textContent = "Press a button based on what you see in the game.";
      return;
    }
    if (timer.paused) return;
    const secondsElapsed = Math.floor((now - timer.startTime) / 1000);
    const secondsInCycle = secondsElapsed % totalCycle;
    const minutes = Math.floor(secondsInCycle / 60);
    const seconds = secondsInCycle % 60;
    display.textContent = String(minutes).padStart(2, "0") + ":" + String(seconds).padStart(2, "0");
    if (secondsInCycle < eventDuration) {
      status.innerHTML = "<span class='event'>üö¢ The ship is here. Enjoy the event!</span>";
      if (!timer.beepPlayedAtStart) {
        playBeep();
        speak("Ship arrived," + getServerText(timer));
        switchVideo(shipArrivesVideo);
        timer.beepPlayedAtStart = true;
        timer.beepPlayedOneMinuteBefore = false;
        timer.spokenOneMinuteBefore = false;
        timer.spokenEventEnd = false;
      }
      if (secondsInCycle === eventDuration - 1 && !timer.spokenEventEnd) {
        speak("The event has ended," + getServerText(timer));
        timer.spokenEventEnd = true;
        switchVideo(shipLeavesVideo);
      }
    } else if (secondsInCycle >= totalCycle - 60) {
      status.innerHTML = "<span class='alert'>‚ö†Ô∏è The ship arrives in less than 1 minute!</span>";
      if (!timer.beepPlayedOneMinuteBefore) {
        playBeep();
        timer.beepPlayedOneMinuteBefore = true;
      }
      if (!timer.spokenOneMinuteBefore) {
        speak("One minute left for the ship," + getServerText(timer));
        timer.spokenOneMinuteBefore = true;
      }
    } else {
      status.innerHTML = "<span class='waiting'>‚åõ The ship has left. Waiting for it to return...</span>";
      switchVideo(shipLeavesVideo);
      if (secondsInCycle < totalCycle - 60) {
        timer.beepPlayedAtStart = false;
        timer.beepPlayedOneMinuteBefore = false;
        timer.spokenOneMinuteBefore = false;
        timer.spokenEventEnd = false;
      }
    }
  }
  addTimer(1);
</script>
</body>
</html>
